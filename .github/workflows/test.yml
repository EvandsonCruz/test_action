name: Validar Palavra "alter" no Conteúdo do PR

on:
  pull_request:
    types:
      - opened
      - synchronize

jobs:
  validar-palavra-no-pr:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout do Código
      uses: actions/checkout@v2

    - name: Validar Palavra "alter"
      run: |
        palavra_a_validar="alter"
        palavra_encontrada=false

        echo ">>>>>>>>>>>>>>: $palavra_a_validar"
        echo ">>>>>>>>>>>>>>: $palavra_encontrada"

        # Iterar sobre todos os arquivos no PR
        for arquivo in $(git diff --name-only ${{ github.event.before }} ${{ github.sha }}); do
          echo "Verificando arquivo: $palavra_a_validar"
          conteudo_arquivo=$(cat "$arquivo")
          echo "Conteudo do arquivo: $palavra_encontrada"

          if echo "$conteudo_arquivo" | grep -q "$palavra_a_validar"; then
            echo "Palavra 'alter' encontrada no conteúdo do arquivo: $arquivo"
            palavra_encontrada=true
          fi
        done

        echo ">>>>>>>>>>>>>>: $conteudo_arquivo"
        echo ">>>>>>>>>>>>>>: $arquivo"

        echo ">>>>>>>>>>>>>>: $palavra_a_validar"
        echo ">>>>>>>>>>>>>>: $palavra_encontrada"

        # Verificar se a palavra foi encontrada em algum arquivo
        if [ "$palavra_encontrada" = true ]; then
          echo "Palavra 'alter' encontrada em pelo menos um arquivo."
          exit 0
        else
          echo "Erro: Palavra 'alter' não encontrada no conteúdo de nenhum arquivo no PR."
          exit 1
        fi
