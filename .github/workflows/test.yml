name: Validar Palavra no Pull Request

on:
  pull_request_target:
    types:
      - opened
      - synchronize

jobs:
  validar-palavra:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout do Código
      uses: actions/checkout@v2

    - name: Validar Palavra
      run: |
        palavra_a_validar="alter"
        palavra_encontrada=false

        # Iterar sobre todos os arquivos modificados no pull request
        for arquivo_modificado in $(git diff --name-only ${{ github.event.before }} ${{ github.sha }}); do
          # Usar awk para procurar a palavra na linha
          if awk -v palavra="$palavra_a_validar" 'BEGIN {IGNORECASE=1} $0 ~ palavra {exit 0} END {exit 1}' "$arquivo_modificado"; then
            echo "Palavra encontrada no arquivo: $arquivo_modificado"
            palavra_encontrada=true
          fi
        done

        # Verificar se a palavra foi encontrada em algum arquivo
        if [ "$palavra_encontrada" = true ]; then
          exit 0
        else
          echo "Erro: Palavra não encontrada em nenhum arquivo."
          exit 1
        fi
