name: identifier too long

on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - edited
    paths-ignore:
      - '.github/workflows/**'

jobs:
  validar-trecho:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout do repositório
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Obter conteúdo do pull request
      id: obter-conteudo
      run: |
         if [[ "${{ github.event.action }}" == "opened" || "${{ github.event.action }}" == "reopened"  ]]; then
            echo "Pull request acabou de ser aberto. Verificando novos arquivos adicionados."

            # Obtém a lista de arquivos adicionados no pull request
            arquivos_adicionados=($(git diff --name-only HEAD^1))
            echo "##########################arquivos_adicionados###################################  $arquivos_adicionados"

            for arquivo in "${arquivos_adicionados[@]}"; do
              echo "Novo arquivo adicionado: $arquivo"

              # Restante do código para verificar a sequência de 31 caracteres após um ponto
              if grep -E '\.\S{31}' "$arquivo"; then
                echo "Encontrada uma sequência de 31 caracteres após um ponto no arquivo: $arquivo"
                encontrada=true
                saida="$saidaSequência de 31 caracteres após um ponto no arquivo $arquivo\n"
              fi
            done
          else 
            for arquivo in $(git diff --name-only ${{ github.event.before }} ${{ github.sha }}); do
              # Restante do código para verificar a sequência de 31 caracteres após um ponto
              if grep -E '\.\S{31}' "$arquivo"; then
                echo "Encontrada uma sequência de 31 caracteres após um ponto no arquivo: $arquivo"
                encontrada=true
                saida="$saidaSequência de 31 caracteres após um ponto no arquivo $arquivo\n"
              fi
            done
          fi
          
          echo ">>>>>>>depois do for>>>>>>>>>>>>> $encontrada"

          if [ "$encontrada" == true ]; then
            echo "::warning::Encontrada uma sequência de 31 caracteres após um ponto."
            #gh pr edit ${{ github.event.number }} --add-label bug
          fi

          echo ">>>>>>>>>>depois da label>>>>>>>>>> $encontrada"

          if [ "$encontrada" == true ]; then
            SLACK_MESSAGE="Identifier too long: ${{ github.event.number }} - github.com/${GITHUB_REPOSITORY}/pull/${{ github.event.number }}/files (${{ github.base_ref }})\n$saida"
            curl -X POST -H 'Content-type: application/json' --data '{"text":"'"$SLACK_MESSAGE"'"}' ${{ secrets.SLACK_WEBHOOK_URL }}
            exit 0
          fi

       
        

        
